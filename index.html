<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tabla Marzo PRO</title>

<style>
body{
    font-family: Arial, sans-serif;
    margin:0;
    padding:10px;
    background:#0f0f0f;
    color:white;
}

h2{
    text-align:center;
    font-size:18px;
}

table{
    width:100%;
    border-collapse: collapse;
    font-size:12px;
}

th, td{
    border:1px solid #333;
    padding:5px;
    text-align:center;
}

th{
    background:#1e1e1e;
}

input{
    width:100%;
    padding:4px;
    text-align:center;
    background:#1a1a1a;
    border:none;
    color:white;
    font-size:12px;
}

img{
    width:50px;
    height:50px;
    object-fit:cover;
    border-radius:6px;
}

button{
    width:100%;
    padding:10px;
    margin-top:10px;
    background:#00c853;
    border:none;
    color:white;
    font-weight:bold;
    border-radius:6px;
}

.resumen{
    margin-top:15px;
    background:#000;
    padding:10px;
    font-size:14px;
    border-radius:8px;
}

.resumen div{
    margin:5px 0;
}
</style>
</head>
<body>

<!-- üîê PANTALLA DE BLOQUEO -->
<div id="bloqueo" style="
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:#000;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
z-index:9999;
color:white;
">

<h2>üîê Acceso Privado</h2>

<input type="password" id="claveInput" placeholder="Ingresa la clave"
style="padding:10px; font-size:16px; margin:10px;">

<button id="btnEntrar"
style="padding:10px 20px; font-size:16px; background:#00c853; border:none; color:white;">
Entrar
</button>

<p id="errorClave" style="color:red;"></p>

</div>

<h2>üìä TABLA DE GANANCIAS - MARZO</h2>

<table id="tabla">
<thead>
<tr>
<th>Foto</th>
<th>Producto</th>
<th>Costo</th>
<th>Venta</th>
<th>Ganancia</th>
<th>Cant</th>
<th>Total</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button onclick="agregarFila()">‚ûï Agregar Producto</button>

<div class="resumen">
<div>üí∞ Cap Invertido: <span id="capInvertido">0</span></div>
<div>üíµ Cap Total: <span id="capTotal">0</span></div>
<div>üìà Ganancia Total: <span id="gananciaGeneral">0</span></div>
</div>

<script>

let tabla = document.querySelector("#tabla tbody");

function formatearNumero(valor){
    valor = valor.replace(/\D/g, "");
    return valor.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

function limpiarNumero(valor){
    return parseFloat(valor.replace(/\./g,'')) || 0;
}

function agregarFila(data = {}){
    let fila = tabla.insertRow();

    fila.innerHTML = `
        <td>
            <input type="file" accept="image/*">
            <br>
            <img src="${data.img || ''}">
        </td>
        <td><input type="text" value="${data.nombre || ''}"></td>
        <td><input type="text" class="numero" value="${data.costo || ''}"></td>
        <td><input type="text" class="numero" value="${data.venta || ''}"></td>
        <td class="ganancia">0</td>
        <td><input type="number" value="${data.cantidad || 1}" min="1"></td>
        <td class="total">0</td>
    `;

    let inputs = fila.querySelectorAll("input");

    inputs.forEach(input=>{
        input.addEventListener("input", ()=>{
            if(input.classList.contains("numero")){
                input.value = formatearNumero(input.value);
            }
            calcularFila(fila);
            guardarDatos();
        });
    });

    let fileInput = fila.querySelector("input[type='file']");
    let img = fila.querySelector("img");

    fileInput.addEventListener("change", function(){
        let reader = new FileReader();
        reader.onload = function(e){
            img.src = e.target.result;
            guardarDatos();
        }
        reader.readAsDataURL(this.files[0]);
    });

    calcularFila(fila);
}

function calcularFila(fila){

    let costo = limpiarNumero(fila.cells[2].children[0].value);
    let venta = limpiarNumero(fila.cells[3].children[0].value);
    let cantidad = parseInt(fila.cells[5].children[0].value) || 0;

    let ganancia = venta - costo;
    let total = ganancia * cantidad;

    fila.querySelector(".ganancia").innerText = ganancia.toLocaleString('es-CO');
    fila.querySelector(".total").innerText = total.toLocaleString('es-CO');

    actualizarResumen();
}

function actualizarResumen(){

    let filas = tabla.rows;

    let capInvertido = 0;
    let capTotal = 0;
    let gananciaGeneral = 0;

    for(let fila of filas){

        let costo = limpiarNumero(fila.cells[2].children[0].value);
        let venta = limpiarNumero(fila.cells[3].children[0].value);
        let cantidad = parseInt(fila.cells[5].children[0].value) || 0;

        capInvertido += costo * cantidad;
        capTotal += venta * cantidad;
        gananciaGeneral += (venta - costo) * cantidad;
    }

    document.getElementById("capInvertido").innerText = capInvertido.toLocaleString('es-CO');
    document.getElementById("capTotal").innerText = capTotal.toLocaleString('es-CO');
    document.getElementById("gananciaGeneral").innerText = gananciaGeneral.toLocaleString('es-CO');
}

function guardarDatos(){

    let datos = [];

    for(let fila of tabla.rows){
        datos.push({
            img: fila.querySelector("img").src,
            nombre: fila.cells[1].children[0].value,
            costo: fila.cells[2].children[0].value,
            venta: fila.cells[3].children[0].value,
            cantidad: fila.cells[5].children[0].value
        });
    }

    localStorage.setItem("tablaMarzo", JSON.stringify(datos));
}

function cargarDatos(){

    let datos = JSON.parse(localStorage.getItem("tablaMarzo"));

    if(datos){
        datos.forEach(dato=>agregarFila(dato));
    }else{
        agregarFila();
    }
}

cargarDatos();

/* üîê L√ìGICA DE CONTRASE√ëA */
document.addEventListener("DOMContentLoaded", function(){

    document.getElementById("btnEntrar").addEventListener("click", function(){

        let clave = document.getElementById("claveInput").value.trim();

        if(clave === "Kaleth2026"){ 
            document.getElementById("bloqueo").style.display = "none";
        } else {
            document.getElementById("errorClave").innerText = "Clave incorrecta";
        }

    });

});

</script>

</body>
</html>