<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tabla PRO</title>

<style>
body{
    font-family: Arial, sans-serif;
    margin:0;
    padding:10px;
    background:#0f0f0f;
    color:white;
}

h2{
    text-align:center;
    font-size:18px;
}

select{
    width:100%;
    padding:8px;
    margin-bottom:10px;
    background:#1a1a1a;
    color:white;
    border:none;
    border-radius:6px;
}

table{
    width:100%;
    border-collapse: collapse;
    font-size:12px;
}

th, td{
    border:1px solid #333;
    padding:5px;
    text-align:center;
}

th{
    background:#1e1e1e;
}

input{
    width:100%;
    padding:4px;
    text-align:center;
    background:#1a1a1a;
    border:none;
    color:white;
    font-size:12px;
}

img{
    width:45px;
    height:45px;
    object-fit:cover;
    border-radius:6px;
    margin:2px;
}

button{
    width:100%;
    padding:10px;
    margin-top:10px;
    background:#00c853;
    border:none;
    color:white;
    font-weight:bold;
    border-radius:6px;
}

.resumen{
    margin-top:15px;
    background:#000;
    padding:10px;
    font-size:14px;
    border-radius:8px;
}

.resumen div{
    margin:5px 0;
}
</style>
</head>
<body>

<!-- üîê BLOQUEO -->
<div id="bloqueo" style="
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:#000;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
z-index:9999;
color:white;
">

<h2>üîê Acceso Privado</h2>

<input type="password" id="claveInput" placeholder="Ingresa la clave"
style="padding:10px; font-size:16px; margin:10px;">

<button id="btnEntrar"
style="padding:10px 20px; font-size:16px; background:#00c853; border:none; color:white;">
Entrar
</button>

<p id="errorClave" style="color:red;"></p>

</div>

<!-- SELECTOR DE MES -->
<select id="selectorMes">
<option value="enero">Enero</option>
<option value="febrero">Febrero</option>
<option value="marzo" selected>Marzo</option>
<option value="abril">Abril</option>
<option value="mayo">Mayo</option>
<option value="junio">Junio</option>
<option value="julio">Julio</option>
<option value="agosto">Agosto</option>
<option value="septiembre">Septiembre</option>
<option value="octubre">Octubre</option>
<option value="noviembre">Noviembre</option>
<option value="diciembre">Diciembre</option>
</select>

<h2>üìà TABLA DE CUENTAS</h2>

<table id="tabla">
<thead>
<tr>
<th>Fotos</th>
<th>Producto</th>
<th>Costo</th>
<th>Venta</th>
<th>Ganancia</th>
<th>Cant</th>
<th>Total</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button onclick="agregarFila()">‚ûï Agregar Producto</button>

<div class="resumen">
<div>üí∞ Cap Invertido: <span id="capInvertido">0</span></div>
<div>üíµ Cap Total: <span id="capTotal">0</span></div>
<div>üìà Ganancia Total: <span id="gananciaGeneral">0</span></div>
</div>
<input type="text" id="nombreInput" placeholder="Escribe tu nombre">
<button onclick="guardar()">Guardar</button>
<script>

let tabla = document.querySelector("#tabla tbody");
let mesActual = document.getElementById("selectorMes").value;

function formatearNumero(valor){
    valor = valor.replace(/\D/g, "");
    return valor.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

function limpiarNumero(valor){
    return parseFloat(valor.replace(/\./g,'')) || 0;
}

function agregarFila(data = {}){
    let fila = tabla.insertRow();

    fila.innerHTML = `
        <td>
            <input type="file" class="file1" accept="image/*">
            <input type="file" class="file2" accept="image/*">
            <br>
            <img class="img1" src="${data.img1 || ''}">
            <img class="img2" src="${data.img2 || ''}">
        </td>
        <td><input type="text" value="${data.nombre || ''}"></td>
        <td><input type="text" class="numero" value="${data.costo || ''}"></td>
        <td><input type="text" class="numero" value="${data.venta || ''}"></td>
        <td class="ganancia">0</td>
        <td><input type="number" value="${data.cantidad || 1}" min="1"></td>
        <td class="total">0</td>
    `;

    let inputs = fila.querySelectorAll("input");

    inputs.forEach(input=>{
        input.addEventListener("input", ()=>{
            if(input.classList.contains("numero")){
                input.value = formatearNumero(input.value);
            }
            calcularFila(fila);
            guardarDatos();
        });
    });

    let file1 = fila.querySelector(".file1");
    let file2 = fila.querySelector(".file2");
    let img1 = fila.querySelector(".img1");
    let img2 = fila.querySelector(".img2");

    file1.addEventListener("change", function(){
        let reader = new FileReader();
        reader.onload = function(e){
            img1.src = e.target.result;
            guardarDatos();
        }
        reader.readAsDataURL(this.files[0]);
    });

    file2.addEventListener("change", function(){
        let reader = new FileReader();
        reader.onload = function(e){
            img2.src = e.target.result;
            guardarDatos();
        }
        reader.readAsDataURL(this.files[0]);
    });

    calcularFila(fila);
}

function calcularFila(fila){

    let costo = limpiarNumero(fila.cells[2].children[0].value);
    let venta = limpiarNumero(fila.cells[3].children[0].value);
    let cantidad = parseInt(fila.cells[5].children[0].value) || 0;

    let ganancia = venta - costo;
    let total = ganancia * cantidad;

    fila.querySelector(".ganancia").innerText = ganancia.toLocaleString('es-CO');
    fila.querySelector(".total").innerText = total.toLocaleString('es-CO');

    actualizarResumen();
}

function actualizarResumen(){

    let filas = tabla.rows;

    let capInvertido = 0;
    let capTotal = 0;
    let gananciaGeneral = 0;

    for(let fila of filas){

        let costo = limpiarNumero(fila.cells[2].children[0].value);
        let venta = limpiarNumero(fila.cells[3].children[0].value);
        let cantidad = parseInt(fila.cells[5].children[0].value) || 0;

        capInvertido += costo * cantidad;
        capTotal += venta * cantidad;
        gananciaGeneral += (venta - costo) * cantidad;
    }

    document.getElementById("capInvertido").innerText = capInvertido.toLocaleString('es-CO');
    document.getElementById("capTotal").innerText = capTotal.toLocaleString('es-CO');
    document.getElementById("gananciaGeneral").innerText = gananciaGeneral.toLocaleString('es-CO');
}

function guardarDatos(){

    let datos = [];

    for(let fila of tabla.rows){
        datos.push({
            img1: fila.querySelector(".img1").src,
            img2: fila.querySelector(".img2").src,
            nombre: fila.cells[1].children[0].value,
            costo: fila.cells[2].children[0].value,
            venta: fila.cells[3].children[0].value,
            cantidad: fila.cells[5].children[0].value
        });
    }

    localStorage.setItem("tabla_" + mesActual, JSON.stringify(datos));
}

function cargarDatos(){

    tabla.innerHTML = "";

    let datos = JSON.parse(localStorage.getItem("tabla_" + mesActual));

    if(datos){
        datos.forEach(dato=>agregarFila(dato));
    }else{
        agregarFila();
    }
}

document.getElementById("selectorMes").addEventListener("change", function(){
    mesActual = this.value;
    cargarDatos();
});

cargarDatos();

/* üîê CONTRASE√ëA */
document.addEventListener("DOMContentLoaded", function(){

    document.getElementById("btnEntrar").addEventListener("click", function(){

        let clave = document.getElementById("claveInput").value.trim();

        if(clave === "kaleth0712"){ 
            document.getElementById("bloqueo").style.display = "none";
        } else {
            document.getElementById("errorClave").innerText = "Clave incorrecta";
        }

    });

});

</script>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBQmOBimHd3kY7e1ebwekmbIsFg65fcB-o",
    authDomain: "cuentass-ce6af.firebaseapp.com",
    projectId: "cuentass-ce6af",
    storageBucket: "cuentass-ce6af.firebasestorage.app",
    messagingSenderId: "512482056422",
    appId: "1:512482056422:web:a671600a82a003656e8327"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

window.guardar = async function() {
  const nombre = document.getElementById("nombreInput").value;

  try {
    await addDoc(collection(db, "usuarios"), {
      nombre: nombre
    });

    alert("Guardado correctamente üî•");
  } catch (error) {
    console.error("Error:", error);
  }
};
  
</script>

</body>
</html>